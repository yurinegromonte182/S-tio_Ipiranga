name: Telegram Notifications

on:
  workflow_dispatch:
    inputs:
      id:
        description: "ID da notificaÃ§Ã£o"
        required: true
      name:
        description: "Nome"
        required: true
      email:
        description: "Email"
        required: true
      phone:
        description: "Telefone"
        required: true
      message:
        description: "Mensagem"
        required: false

jobs:
  send_telegram:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar notificaÃ§Ã£o para o Telegram
        env:
          TELEGRAM_BOT_TOKEN: "8054042928:AAGDlShuhpKRNtbJf-bTyoh7BkMwUOyv8c8"
          TELEGRAM_CHAT_ID: "80665123000"
        run: |
          TEXT="ðŸ”” *Nova NotificaÃ§Ã£o Recebida* ðŸ””

          ðŸ†” *ID:* ${{ github.event.inputs.id }}
          ðŸ‘¤ *Nome:* ${{ github.event.inputs.name }}
          ðŸ“§ *Email:* ${{ github.event.inputs.email }}
          ðŸ“± *Telefone:* ${{ github.event.inputs.phone }}
          ðŸ’¬ *Mensagem:* ${{ github.event.inputs.message }}"

          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="$TEXT" \
            -d parse_mode="Markdown"

  notify_supabase:
    runs-on: ubuntu-latest
    needs: send_telegram
    steps:
      - name: Enviar para Supabase
        env:
          SUPABASE_URL: "https://erbefbnjxgpetbetlzya.supabase.co"
          SUPABASE_SERVICE_KEY: "" # <-- coloque sua service key aqui
        run: |
          JSON=$(jq -n \
            --arg id "${{ github.event.inputs.id }}" \
            --arg name "${{ github.event.inputs.name }}" \
            --arg email "${{ github.event.inputs.email }}" \
            --arg phone "${{ github.event.inputs.phone }}" \
            --arg message "${{ github.event.inputs.message }}" \
            '{id: $id, name: $name, email: $email, phone: $phone, message: $message}')

          curl -X POST "$SUPABASE_URL/rest/v1/notifications" \
            -H "apikey: $SUPABASE_SERVICE_KEY" \
            -H "Authorization: Bearer $SUPABASE_SERVICE_KEY" \
            -H "Content-Type: application/json" \
            -d "$JSON"
