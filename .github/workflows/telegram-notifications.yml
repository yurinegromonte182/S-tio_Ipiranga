name: ğŸŒ¿ NotificaÃ§Ãµes com Python

on:
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: ğŸ“¤ Enviar com Python
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          python3 -c "
import requests
import os
import json
from datetime import datetime

token = os.getenv('BOT_TOKEN')
chat_id = os.getenv('CHAT_ID')

print(f'Token: {token[:10]}...')
print(f'Chat ID: {chat_id}')

# Contar plantas
try:
    with open('dados.geojson', 'r') as f:
        data = json.load(f)
    plantas = len(data.get('features', []))
except:
    plantas = 0

# Mensagem
data_hora = datetime.now().strftime('%d/%m/%Y %H:%M')
mensagem = f'''ğŸŒ¿ *SÃ­tio Ipiranga*
ğŸ“… {data_hora}
ğŸŒ³ *{plantas} plantas* cadastradas
âœ… Sistema ativo

ğŸ“± *Acesse o app:*
https://yurimegromonte182.github.io/S-tio_Jintanga/'''

print('Enviando mensagem...')

url = f'https://api.telegram.org/bot{token}/sendMessage'
payload = {
    'chat_id': chat_id,
    'text': mensagem,
    'parse_mode': 'Markdown'
}

response = requests.post(url, json=payload)
print(f'Status: {response.status_code}')
print(f'Resposta: {response.text}')

if response.status_code == 200:
    print('âœ… Sucesso!')
    exit(0)
else:
    print('âŒ Erro!')
    exit(1)
"
