name: NotificaÃ§Ãµes Telegram - SÃ­tio Ipiranga

on:
  workflow_dispatch:

jobs:
  notify-telegram:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Enviar NotificaÃ§Ã£o
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "Iniciando envio para Telegram..."
          
          # SaudaÃ§Ã£o SIMPLES (sem emojis)
          HORA_NUM=$(date +%H)
          if [ "$HORA_NUM" -lt 12 ]; then
            SAUDACAO="Bom dia"
          elif [ "$HORA_NUM" -lt 18 ]; then
            SAUDACAO="Boa tarde"
          else
            SAUDACAO="Boa noite"
          fi
          
          # Data
          DATA=$(date +"%d/%m/%Y")
          HORA=$(date +"%H:%M")
          
          # Contar plantas (se existir o arquivo)
          if [ -f "dados.geojson" ]; then
            TOTAL_PLANTAS=$(jq '.features | length' dados.geojson 2>/dev/null || echo "0")
          else
            TOTAL_PLANTAS="0"
          fi
          
          # Montar mensagem (emojis no conteÃºdo da mensagem Ã© OK)
          MESSAGE="$SAUDACAO!%0A"
          MESSAGE="${MESSAGE}ðŸŒ¿ SÃ­tio Ipiranga%0A"
          MESSAGE="${MESSAGE}ðŸ“… ${DATA} Ã s ${HORA}%0A"
          MESSAGE="${MESSAGE}ðŸŒ³ Plantas: ${TOTAL_PLANTAS}%0A"
          MESSAGE="${MESSAGE}âœ… NotificaÃ§Ã£o teste%0A"
          MESSAGE="${MESSAGE}%0AðŸ“± https://yurimegromonte182.github.io/S-tio_Jintanga/"
          
          echo "Mensagem preparada"
          
          # Enviar para Telegram
          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="${MESSAGE}" \
            -d parse_mode="Markdown"
          
          echo "âœ… Mensagem enviada para Telegram!"
