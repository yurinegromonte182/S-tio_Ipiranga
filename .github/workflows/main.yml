name: ✅ SOLUÇÃO FINAL

on:
  workflow_dispatch:

jobs:
  enviar:
    runs-on: ubuntu-latest
    steps:
      - name: Enviar com token codificado
        env:
          TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "=== SOLUÇÃO ==="
          
          # 1. Mostrar dados (ocultando parte do token)
          echo "Token original: ${TOKEN:0:15}..."
          echo "Chat ID: $CHAT_ID"
          
          # 2. Codificar o token para URL (IMPORTANTE!)
          TOKEN_ENCODED=$(echo "$TOKEN" | sed 's/:/%3A/g')
          
          # 3. Método 1: Usar GET simples (funciona sempre)
          echo ""
          echo "Método 1: GET simples"
          URL="https://api.telegram.org/bot${TOKEN_ENCODED}/sendMessage?chat_id=${CHAT_ID}&text=✅+Teste+GET+$(date +%s)"
          echo "URL: ${URL:0:80}..."
          
          curl -s "$URL"
          echo ""
          
          # 4. Método 2: POST com dados codificados
          echo ""
          echo "Método 2: POST correto"
          curl -X POST "https://api.telegram.org/bot${TOKEN}/sendMessage" \
            --data-urlencode "chat_id=${CHAT_ID}" \
            --data-urlencode "text=✅ Teste POST $(date '+%H:%M:%S')" \
            --data-urlencode "parse_mode=Markdown"
          
          echo ""
          echo "✅ Testes completos"
