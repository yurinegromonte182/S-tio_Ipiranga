name: üîç VER ERRO REAL DO CURL

on:
  workflow_dispatch:

jobs:
  ver-erro:
    runs-on: ubuntu-latest
    steps:
      - name: Ver erro COMPLETO do curl
        env:
          TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "=== DETALHES ==="
          echo "Token: ${TOKEN:0:20}..."
          echo "Chat ID: $CHAT_ID"
          echo ""
          
          echo "=== TESTE CURL COM VERBOSE ==="
          
          # Comando que MOSTRA TUDO
          curl -v \
               --fail \
               --show-error \
               --max-time 30 \
               -X POST "https://api.telegram.org/bot${TOKEN}/sendMessage" \
               -H "Content-Type: application/x-www-form-urlencoded" \
               -d "chat_id=${CHAT_ID}" \
               -d "text=Teste simples" \
               -d "parse_mode=Markdown" \
               2>&1 | tee /tmp/curl_output.txt
          
          echo ""
          echo "=== C√ìDIGO DE SA√çDA: $? ==="
          
          if [ $? -eq 0 ]; then
            echo "‚úÖ CURL executado com sucesso!"
          else
            echo "‚ùå CURL falhou!"
            echo ""
            echo "√öltimas 10 linhas do output:"
            tail -10 /tmp/curl_output.txt
          fi
